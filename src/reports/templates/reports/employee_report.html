{% extends 'base.html' %}
{% block title %}Raport pracownika{% endblock %}
{% block content %}
<div class="container">
  <h1 class="text-center mb-4 header-font text-primary">Raport pracownika</h1>

  {% if selected_employee %}
    <h3 class="text-center mb-2">{{ selected_employee.first_name }} {{ selected_employee.last_name }}</h3>

    {% if chart_labels %}
      <div class="chart-wrapper" style="position: relative; width: 100%; max-width: 800px; margin: auto;">
        <canvas id="employeeChart"></canvas>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
        const labels = {{ chart_labels|default:"[]"|safe }};
        const values = {{ chart_values|default:"[]"|safe }};

        if (labels.length > 0 && values.length > 0) {
            const ctx = document.getElementById('employeeChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Ocena przełożonego (%)',
                        data: values,
                        backgroundColor: 'rgba(1, 112, 209, 0.5)',
                        borderColor: 'rgba(0, 0, 0, 0.38)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // ważne dla responsywności
                    indexAxis: 'y', // poziomy wykres
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'Wynik procentowy (%)' }
                        },
                        y: {
                            title: { display: true, text: 'Data ankiety' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: true }
                    }
                }
            });
        }
      </script>
    {% else %}
      <p class="text-center text-muted mt-4">Brak ocen managera dla tego pracownika.</p>
    {% endif %}

    <div class="text-center mt-4">
      <a href="{% url 'reports_home' %}" class="btn btn-secondary">← Powrót</a>
    </div>

  {% else %}
    <p class="text-center text-muted mt-4">Nie wybrano pracownika.</p>
    <div class="text-center mt-3">
      <a href="{% url 'reports_home' %}" class="btn btn-primary">Wybierz pracownika</a>
    </div>
  {% endif %}
</div>

<style>
  /* Dodatkowe poprawki dla małych ekranów */
  @media (max-width: 576px) {
    .header-font {
      font-size: 1.5rem;
    }
    .chart-wrapper {
      height: 300px; /* zmniejszona wysokość wykresu na mobile */
    }
  }

  @media (min-width: 577px) {
    .chart-wrapper {
      height: 400px; /* standardowa wysokość wykresu na większe ekrany */
    }
  }
</style>
{% endblock %}
