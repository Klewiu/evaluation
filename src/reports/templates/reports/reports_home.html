{% extends 'base.html' %}
{% block title %}Raporty{% endblock %}

{% block content %}
<div class="container">
  <h1 class="mb-5 text-center header-font text-primary">Panel Raportów</h1>
  <div class="row g-4 justify-content-center mt-1">

    <!-- Karta 1: Raporty działu -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body text-center bg-light">
          <h3 class="card-title mb-3 header-font">Raporty działu</h3>
          <h5 class="card-title mb-3 header-font text-primary">Uzyskana oceny - wykres słupkowy</h3>
          <form id="deptForm" method="get" action="{% url 'department_report' %}">

              <!-- Wybór działu -->
              <div class="mb-3">
                  <label for="dzial" class="form-label">Wybierz dział:</label>
                  <select class="form-select" id="dzial" name="department"
                          hx-get="{% url 'get_surveys' %}"
                          hx-target="#ankieta"
                          hx-include="#rok"
                          hx-trigger="change"
                          required>
                      <option selected disabled value="">Wybierz...</option>
                      {% for dep in departments %}
                          <option value="{{ dep.id }}" {% if dep.id|stringformat:"s" == selected_department_id %}selected{% endif %}>
                              {{ dep.name }}
                          </option>
                      {% endfor %}
                  </select>
              </div>

              <!-- Wybór roku -->
              <div class="mb-3">
                  <label for="rok" class="form-label">Wybierz rok:</label>
                  <select class="form-select" id="rok" name="year"
                          hx-get="{% url 'get_surveys' %}"
                          hx-target="#ankieta"
                          hx-include="#dzial"
                          hx-trigger="change"
                          required>
                      <option value="">Najnowszy</option>
                      {% for y in years %}
                          <option value="{{ y }}" {% if y|stringformat:"s" == selected_year %}selected{% endif %}>
                              {{ y }}
                          </option>
                      {% endfor %}
                  </select>
              </div>

              <!-- Wybór ankiety -->
              <div class="mb-3">
                  <label for="ankieta" class="form-label">Wybierz ankietę:</label>
                  <select class="form-select" id="ankieta" name="survey" required>
                      {% include "reports/partials/_survey_options.html" %}
                  </select>
              </div>

              <button type="submit" class="btn btn-primary w-100">OK</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Karta 2: Raport działu - wykres radar -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body text-center bg-light">
          <h3 class="card-title mb-3 header-font">Raport działu</h3>
          <h5 class="card-title mb-3 header-font text-primary">Wykres radar - kompetencje</h5>
          <form id="deptRadarForm" method="get" action="{% url 'department_radar_report' %}">
              <!-- Wybór działu -->
              <div class="mb-3">
                  <label for="dzial_radar" class="form-label">Wybierz dział:</label>
                  <select class="form-select" id="dzial_radar" name="department"
                          hx-get="{% url 'get_surveys' %}"
                          hx-target="#ankieta_radar"
                          hx-include="#rok_radar"
                          hx-trigger="change"
                          required>
                      <option selected disabled value="">Wybierz...</option>
                      {% for dep in departments %}
                          <option value="{{ dep.id }}">{{ dep.name }}</option>
                      {% endfor %}
                  </select>
              </div>

              <!-- Wybór roku -->
              <div class="mb-3">
                  <label for="rok_radar" class="form-label">Wybierz rok:</label>
                  <select class="form-select" id="rok_radar" name="year"
                          hx-get="{% url 'get_surveys' %}"
                          hx-target="#ankieta_radar"
                          hx-include="#dzial_radar"
                          hx-trigger="change"
                          required>
                      <option value="">Najnowszy</option>
                      {% for y in years %}
                          <option value="{{ y }}">{{ y }}</option>
                      {% endfor %}
                  </select>
              </div>

              <!-- Wybór ankiety -->
              <div class="mb-3">
                  <label for="ankieta_radar" class="form-label">Wybierz ankietę:</label>
                  <select class="form-select" id="ankieta_radar" name="survey" required>
                      {% include "reports/partials/_survey_options.html" %}
                  </select>
              </div>

              <!-- Wybór typu oceny -->
              <div class="mb-3">
                  <label for="score_type" class="form-label">Wybierz typ oceny:</label>
                  <select class="form-select" id="score_type" name="score_type" required>
                      <option value="employee">Ocena pracownika</option>
                      <option value="manager">Ocena przełożonego</option>
                  </select>
              </div>

              <button type="submit" class="btn btn-primary w-100">Generuj wykres radar</button>
          </form>
        </div>
      </div>
    </div>


    <!-- Karta 3: Porównanie ankiet pracownika -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body text-center bg-light">
          <h4 class="card-title mb-3 header-font">Porównanie ankiet pracownika</h4>
          <form id="employeeForm" method="get" action="{% url 'employee_report' %}">
            <label class="form-label">Wybierz pracownika:</label>
            <select class="form-select" name="employee" required>
              <option selected disabled value="">Wybierz...</option>
              {% for emp in employees %}
                <option value="{{ emp.id }}">{{ emp.first_name }} {{ emp.last_name }}</option>
              {% endfor %}
            </select>
            <button type="submit" class="btn btn-primary w-100 mt-4">OK</button>
          </form>
        </div>
      </div>
    </div>

    <!-- Karta 4: Porównanie działów -->
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body text-center bg-light">
          <h3 class="card-title mb-3 header-font">Porównanie działów</h3>
          <form action="{% url 'latest_survey_report' %}">
            <div class="mb-4">
              <p>Porównanie wszystkich pracowników z wszystkich działów</p>
            </div>
            <button type="submit" class="btn btn-primary w-100">
              OK
            </button>
          </form>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}
