{% extends "base.html" %}
{% load static %}
{% load dict_filters %}

{% block title %}Ocena pracownika{% endblock %}

{% block content %}
<style>
.custom-radio input[type="radio"] { display: none; }
.custom-radio span.radio-circle {
  display: inline-block; width: 20px; height: 20px; border-radius: 50%;
  border: 2px solid #ccc; margin-right: 5px; vertical-align: middle;
  position: relative; transition: background-color 0.2s, border-color 0.2s, opacity 0.2s;
}
.custom-radio span.radio-label { margin-right: 10px; vertical-align: middle; }

.employee-radio input[type="radio"]:checked + span.radio-circle { 
  background-color: #0d6efd; /* Bootstrap primary */
  border-color: #0d6efd; 
}
.employee-radio input[type="radio"]:disabled + span.radio-circle,
.employee-text textarea:disabled { opacity: 0.7; cursor: default; }

.manager-radio input[type="radio"]:checked + span.radio-circle { 
  background-color: #343a40; /* Bootstrap dark */
  border-color: #343a40; 
}
.manager-radio .custom-radio span.radio-circle:hover { cursor: pointer; }

.radio-group { margin-bottom: 10px; }
.employee-text textarea { 
  width: 100%; resize: vertical; 
  border-color: #0d6efd; background-color: #e9f2ff;
}
.manager-text textarea { 
  width: 100%; resize: vertical; 
  border-color: #343a40; background-color: #f8f9fa;
}

.question-card {
  background-color: #f8f9fa;
  border-radius: 0.5rem;
  padding: 1rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}
</style>

<div class="container">
    <h2>Ocena pracownika: {{ employee_response.user.get_full_name }}</h2>
    <p>Ankieta: {{ employee_response.survey.name }}</p>
    <form method="post">
        {% csrf_token %}

        {% for ans in employee_answers %}
        <div class="question-card">
            <p><strong>{{ forloop.counter }}. {{ ans.question.text }}</strong></p>

            {% if ans.scale_value is not None %}
                <!-- Ocena pracownika (niebieska, disabled) -->
                <div class="radio-group employee-radio">
                    {% for i in scale_choices %}
                        <label class="custom-radio">
                            <input type="radio"
                                   name="employee_scale_{{ ans.question.id }}"
                                   value="{{ i }}"
                                   {% if ans.scale_value == i %}checked{% endif %}
                                   disabled>
                            <span class="radio-circle"></span>
                            <span class="radio-label">{{ i }}</span>
                        </label>
                    {% endfor %}
                </div>

                <!-- Komentarz pracownika -->
                {% if ans.text_value %}
                <div class="form-group mt-2 employee-text">
                    <label>Komentarz pracownika:</label>
                    <textarea class="form-control" rows="2" disabled>{{ ans.text_value }}</textarea>
                </div>
                {% endif %}

                <!-- Ocena managera (ciemnoszara) -->
                <div class="radio-group manager-radio mt-3">
                    <p>Ocena managera:</p>
                    {% with manager_eval=manager_evals_dict|dict_get:ans.question.id %}
                        {% for i in scale_choices %}
                            <label class="custom-radio">
                                <input type="radio"
                                       name="manager_scale_{{ ans.question.id }}"
                                       value="{{ i }}"
                                       {% if manager_eval and manager_eval.scale_value == i %}checked{% endif %}>
                                <span class="radio-circle"></span>
                                <span class="radio-label">{{ i }}</span>
                            </label>
                        {% endfor %}
                    {% endwith %}
                </div>
            {% else %}
                <!-- Pytanie tylko tekstowe -->
                {% if ans.text_value %}
                <div class="form-group mt-2 employee-text">
                    <label>Komentarz pracownika:</label>
                    <textarea class="form-control" rows="2" disabled>{{ ans.text_value }}</textarea>
                </div>
                {% endif %}
            {% endif %}

            <!-- Komentarz managera (zawsze) -->
            <div class="form-group mt-2 manager-text">
                <label for="text_{{ ans.question.id }}">Komentarz managera</label>
                {% with manager_eval=manager_evals_dict|dict_get:ans.question.id %}
                    <textarea class="form-control" name="text_{{ ans.question.id }}" rows="2">{% if manager_eval %}{{ manager_eval.text_value }}{% endif %}</textarea>
                {% endwith %}
            </div>
        </div>
        {% endfor %}

        <button type="submit" class="btn btn-primary mt-3">Zapisz oceny</button>
        <a href="{% url 'manager_employees' %}" class="btn btn-secondary mt-3">Anuluj</a>
    </form>
</div>
{% endblock %}
