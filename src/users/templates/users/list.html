{% extends "base.html" %}

{% block content %}
<div class="container py-4">

  <!-- Header -->
  <div class="row align-items-center g-2 mb-3">
    <div class="col">
      <h1 class="mb-0 d-flex align-items-center header-font text-primary">
        Użytkownicy
        <span class="ms-2">
          <i class="bi bi-info-circle-fill text-secondary fs-5"
             role="img"
             aria-label="Wskazówka"
             data-bs-toggle="popover"
             data-bs-placement="bottom"
             data-bs-container="body"
             data-bs-trigger="hover focus"
             data-bs-html="true"
             data-bs-title="Wskazówka"
             data-bs-content="<div class='mb-1'><strong>Utwórz nowego użytkownika</strong>, zmodyfikuj lub usuń istniejącego użytkownika.</div>">
          </i>
        </span>
      </h1>
    </div>

    <div class="col-12 col-sm-auto d-flex flex-wrap gap-2">
      <a href="{% url 'departments_list' %}" class="btn btn-dark">
        <i class="bi bi-building"></i> Działy
      </a>

      <button
        type="button"
        class="btn btn-primary"
        data-bs-toggle="modal"
        data-bs-target="#createUserModal"
        hx-get="{% url 'user_new' %}"
        hx-target="#create-user-modal-content"
        hx-swap="innerHTML">
        <i class="bi bi-person-plus"></i> Dodaj użytkownika
      </button>
    </div>
  </div>

  <!-- Table: all columns visible; horizontal scroll on small screens -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle text-center">
      <thead class="table-light">
        <tr>
          <th class="text-center">Użytkownik</th>
          <th class="text-center text-nowrap">Rola</th>
          <th class="text-center text-nowrap">Dział</th>
          <th class="text-center text-nowrap">Admin</th>
          <th class="text-center text-nowrap">Ostatnie logowanie</th>
          <th class="text-center text-nowrap">Akcje</th>
        </tr>
      </thead>
      <tbody id="user-table-body">
        {% include "users/_rows.html" with users=users %}
      </tbody>
    </table>
  </div>
</div>

<!-- CREATE Modal -->
<div class="modal fade"
      id="createUserModal"
      tabindex="-1"
      aria-hidden="true"
      hx-on="userCreated: bootstrap.Modal.getOrCreateInstance(this).hide()">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" id="create-user-modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Nowy użytkownik</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
      </div>
      <div class="modal-body">
        <div class="text-muted">Wczytywanie formularza…</div>
      </div>
    </div>
  </div>
</div>

<!-- EDIT Modal -->
<div class="modal fade"
      id="editUserModal"
      tabindex="-1"
      aria-hidden="true"
      hx-on="userUpdated: bootstrap.Modal.getOrCreateInstance(this).hide()">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" id="edit-user-modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edytuj użytkownika</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
      </div>
      <div class="modal-body">
        <div class="text-muted">Wybierz użytkownika do edycji…</div>
      </div>
    </div>
  </div>
</div>

<!-- DELETE Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" id="confirm-delete-modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Usuwanie użytkownika</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Zamknij"></button>
      </div>
      <div class="modal-body">
        <div class="text-muted">Wybierz użytkownika do usunięcia…</div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
